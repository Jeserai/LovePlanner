# 🎯 习惯任务功能测试指南

## 📋 **功能概述**

简化版习惯任务功能已经实现，包含以下核心特性：

### ✅ **已实现的功能**

1. **习惯任务创建**
   - 选择任务类型为"习惯任务"
   - 设置挑战持续时间（21天、30天、180天、365天）
   - 设置任务开始和结束日期
   - 自动计算最晚领取日期
   - 时间范围验证

2. **习惯任务显示**
   - 任务卡片显示习惯任务特殊信息
   - 任务详情显示挑战持续时间、任务期间、最晚加入日期
   - 显示用户的个人挑战进度（如果已参与）

3. **用户参与机制**
   - 加入挑战按钮（在截止日期前）
   - 每日打卡功能
   - 放弃挑战功能
   - 挑战状态显示

4. **数据服务**
   - 习惯任务服务 (`habitTaskService`)
   - 个人挑战管理
   - 打卡记录管理
   - 自动过期检查

---

## 🧪 **测试步骤**

### **1. 数据库准备**

首先需要运行数据库迁移脚本：

```sql
-- 在Supabase SQL编辑器中运行
-- 文件：database/habit_tasks_migration.sql
```

### **2. 创建习惯任务测试**

1. **打开任务看板**
   - 访问 http://localhost:3001
   - 登录后进入任务看板

2. **创建新的习惯任务**
   - 点击"新建任务"按钮
   - 选择任务类型：**习惯任务**
   - 填写基本信息：
     ```
     标题: 21天早起挑战
     描述: 每天早上7点前起床并打卡
     积分: 10分/次
     ```
   - 设置习惯挑战参数：
     ```
     挑战持续时间: 21天
     任务开始日期: 今天
     任务截止日期: 30天后
     ```
   - 观察计算信息显示：
     - 最晚领取日期应该是截止日期前21天
     - 可用天数应该显示30天（需要21天）

3. **验证创建结果**
   - 任务应该成功创建
   - 在"我发布的"视图中能看到新创建的习惯任务
   - 任务卡片应该显示习惯任务的特殊信息

### **3. 用户参与测试**

1. **查看可领取任务**
   - 切换到"可领取的"视图
   - 应该能看到刚创建的习惯任务
   - 点击任务卡片查看详情

2. **加入挑战**
   - 在任务详情中点击"加入挑战"按钮
   - 应该显示成功加入的提示
   - 任务详情应该更新显示个人挑战信息

3. **每日打卡**
   - 在个人挑战中点击"今日打卡"按钮
   - 应该显示打卡成功的提示
   - 进度信息应该更新（如：1/21天）

4. **查看我的挑战**
   - 切换到"我领取的"视图
   - 应该能看到参与的习惯挑战
   - 显示当前进度和状态

### **4. 边界情况测试**

1. **时间验证测试**
   - 尝试创建时间范围不足的习惯任务
   - 应该显示"时间范围不足"的错误提示

2. **重复参与测试**
   - 尝试重复加入同一个挑战
   - 应该显示"已经参与过此挑战"的错误

3. **过期加入测试**
   - 等待任务过了最晚领取日期
   - 应该显示"加入截止日期已过"

4. **重复打卡测试**
   - 在同一天尝试多次打卡
   - 应该显示"今天已经打卡了"的错误

---

## 🎮 **Mock API测试**

如果不想使用真实数据库，可以使用Mock API进行测试：

1. **启用Mock API**
   - 在任务看板页面，应该能看到右下角的"开发工具"面板
   - 点击"启用Mock API"按钮

2. **Mock数据包含**
   - 预设的习惯任务示例
   - 模拟的用户挑战数据
   - 模拟的打卡记录

3. **测试Mock功能**
   - 所有UI交互都应该正常工作
   - 数据会保存在内存中（刷新页面会重置）

---

## 🐛 **已知问题和限制**

### **当前限制**
1. **数据库依赖**: 需要手动运行数据库迁移脚本
2. **时间处理**: 时间计算基于本地时区，可能需要服务器端验证
3. **实时更新**: 多用户同时操作时可能需要手动刷新
4. **打卡验证**: 目前没有防止作弊的机制

### **可能的错误**
1. **数据库连接错误**: 确保Supabase配置正确
2. **权限错误**: 确保RLS策略正确设置
3. **类型错误**: 确保duration字段类型匹配

---

## 🔧 **故障排除**

### **常见问题**

1. **"习惯任务必须设置开始和结束日期"**
   - 确保在创建习惯任务时填写了开始和结束日期

2. **"时间范围不足"**
   - 确保结束日期与开始日期之间的天数大于等于挑战天数

3. **"领取已截止"**
   - 检查当前日期是否超过了最晚领取日期

4. **"加入挑战失败"**
   - 检查数据库连接和表结构
   - 确保用户已登录

### **调试工具**

1. **浏览器开发者工具**
   - 查看Console中的错误信息
   - 检查Network请求是否成功

2. **Mock API开关**
   - 使用Mock API测试UI逻辑
   - 排除数据库相关问题

3. **数据库查询**
   - 直接在Supabase中查询相关表
   - 验证数据是否正确保存

---

## 🎯 **下一步开发**

### **优先级功能**
1. **挑战完成检测**: 自动检测用户是否完成了整个挑战
2. **奖励机制**: 完成挑战后的积分奖励
3. **统计面板**: 显示挑战参与统计
4. **通知系统**: 提醒用户打卡

### **增强功能**
1. **挑战模板**: 预设常见的习惯挑战
2. **社交功能**: 查看其他用户的挑战进度
3. **数据可视化**: 打卡日历和进度图表
4. **导出功能**: 导出个人挑战数据

---

## ✅ **测试检查清单**

- [ ] 数据库迁移脚本执行成功
- [ ] 能够创建习惯任务
- [ ] 时间验证逻辑正确
- [ ] 任务详情显示完整
- [ ] 用户能够加入挑战
- [ ] 每日打卡功能正常
- [ ] 进度更新正确
- [ ] 错误处理合理
- [ ] Mock API功能正常
- [ ] 所有UI主题适配正确

完成以上测试后，习惯任务功能就可以投入使用了！🎉
