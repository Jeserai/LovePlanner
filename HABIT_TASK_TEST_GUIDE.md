# 🎯 打卡任务测试指南

## 测试环境准备

### 1. 确保服务器运行
```bash
npm run dev
# 访问 http://localhost:3004
```

### 2. 登录系统
- 使用快捷登录或正常登录
- 确保有情侣关系（两个用户账号）

## 📋 测试步骤

### 第一步：创建习惯任务

1. **进入任务看板**
   - 点击"新建任务"按钮

2. **填写任务信息**
   ```
   任务标题: 每日喝水打卡
   任务描述: 每天喝8杯水，养成健康习惯
   任务类型: 习惯任务 (habit)
   积分奖励: 10分
   需要凭证: ✓ (可选)
   ```

3. **设置重复频率**
   ```
   重复频率: 每天 (daily)
   不限时任务: ✓ (勾选)
   连续次数: 7天 (或21天)
   ```

4. **创建任务**
   - 点击"创建任务"
   - 应该看到成功提示

### 第二步：领取习惯挑战

1. **切换到"可领取的"视图**
   - 使用另一个用户账号登录
   - 或者在当前账号的"可领取的"标签页

2. **找到习惯任务**
   - 应该看到刚创建的习惯任务
   - 任务卡片会显示"习惯挑战"标识

3. **领取挑战**
   - 点击任务卡片查看详情
   - 点击"参与挑战"按钮
   - 应该看到成功提示

### 第三步：每日打卡

1. **查看个人挑战**
   - 在"我领取的"视图中找到习惯任务
   - 点击查看任务详情

2. **执行打卡**
   - 点击"今日打卡"按钮
   - 如果需要凭证，上传图片或填写说明
   - 点击确认打卡

3. **验证打卡结果**
   - 应该看到打卡成功提示
   - 任务进度应该更新 (例如: 1/7天)
   - 积分应该增加

### 第四步：连续打卡测试

1. **模拟多天打卡**
   ```javascript
   // 在浏览器控制台执行（仅用于测试）
   // 注意：这需要修改数据库中的日期
   ```

2. **测试打卡限制**
   - 尝试同一天打卡两次（应该失败）
   - 验证错误提示是否正确

3. **测试挑战完成**
   - 完成所有要求的打卡天数
   - 验证挑战状态变为"已完成"
   - 检查总积分是否正确

## 🧪 具体测试用例

### 用例1：基础打卡流程
```
前置条件: 已创建习惯任务并领取挑战
测试步骤:
1. 进入任务详情
2. 点击"今日打卡"
3. 填写打卡信息（可选）
4. 确认打卡

预期结果:
- 打卡成功提示
- 进度更新 (1/7)
- 积分增加
- 按钮变为"今日已打卡"
```

### 用例2：重复打卡限制
```
前置条件: 今天已经打卡过
测试步骤:
1. 再次尝试打卡

预期结果:
- 显示"今天已经打卡了"错误提示
- 打卡按钮应该被禁用或显示已打卡状态
```

### 用例3：挑战完成
```
前置条件: 已打卡6天，今天是第7天
测试步骤:
1. 执行第7天打卡

预期结果:
- 打卡成功
- 挑战状态变为"已完成"
- 显示挑战完成庆祝信息
- 总积分正确计算
```

### 用例4：挑战过期
```
前置条件: 挑战已过期但未完成
测试步骤:
1. 尝试打卡

预期结果:
- 显示"挑战已过期"错误提示
- 挑战状态变为"失败"
```

## 🔍 UI验证要点

### 任务卡片显示
- [ ] 习惯任务有特殊标识
- [ ] 显示挑战进度 (X/Y天)
- [ ] 显示剩余天数
- [ ] 显示总积分

### 任务详情页面
- [ ] 显示挑战信息
- [ ] 显示打卡历史
- [ ] 显示当前进度
- [ ] 打卡按钮状态正确

### 打卡功能
- [ ] 打卡按钮可用性正确
- [ ] 打卡成功反馈
- [ ] 打卡失败错误提示
- [ ] 进度实时更新

## 🐛 常见问题排查

### 问题1: 找不到习惯任务
**可能原因:**
- 任务类型不是'habit'
- 重复频率设置错误
- 用户权限问题

**解决方法:**
- 检查任务创建时的参数
- 查看数据库中的任务记录

### 问题2: 打卡按钮不显示
**可能原因:**
- 未正确领取挑战
- 挑战状态不是'active'
- 今天已经打卡

**解决方法:**
- 检查个人挑战记录
- 验证挑战状态和日期

### 问题3: 打卡失败
**可能原因:**
- 网络连接问题
- 数据库权限问题
- 挑战已过期

**解决方法:**
- 检查浏览器控制台错误
- 查看服务器日志
- 验证数据库连接

## 📊 数据验证

### 数据库表检查
```sql
-- 检查个人挑战记录
SELECT * FROM personal_habit_challenges WHERE user_id = 'your-user-id';

-- 检查打卡记录
SELECT * FROM habit_completions WHERE personal_challenge_id = 'challenge-id';

-- 检查任务记录
SELECT * FROM tasks WHERE task_type = 'habit';
```

### 预期数据结构
```json
{
  "personal_habit_challenge": {
    "id": "uuid",
    "task_id": "task-uuid", 
    "user_id": "user-uuid",
    "status": "active",
    "total_completions": 3,
    "total_points_earned": 30
  },
  "habit_completion": {
    "id": "uuid",
    "personal_challenge_id": "challenge-uuid",
    "completion_date": "2024-01-15",
    "points_earned": 10
  }
}
```

## 🎉 测试完成检查清单

- [ ] 能够创建习惯任务
- [ ] 能够领取习惯挑战  
- [ ] 能够每日打卡
- [ ] 打卡进度正确更新
- [ ] 积分计算正确
- [ ] 重复打卡被阻止
- [ ] 挑战完成时状态正确
- [ ] 过期挑战处理正确
- [ ] UI反馈清晰准确
- [ ] 错误处理友好

完成以上测试后，打卡任务功能应该运行正常！🚀
