# ğŸ”„ ç»Ÿä¸€ä»»åŠ¡ç³»ç»Ÿæ€»ç»“

## ğŸ¯ **æ ¸å¿ƒç†å¿µ**

æ‚¨çš„æ´å¯Ÿéå¸¸æ­£ç¡®ï¼š**ä¹ æƒ¯ä»»åŠ¡å’Œé‡å¤æ€§ä»»åŠ¡æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç³»ç»Ÿ**ã€‚å®ƒä»¬éƒ½æ˜¯"éœ€è¦å¤šæ¬¡æ‰§è¡Œçš„ä»»åŠ¡"ï¼Œåªæ˜¯åœ¨å‚ä¸æ¨¡å¼å’Œå®Œæˆè¦æ±‚ä¸Šæœ‰æ‰€ä¸åŒã€‚

---

## ğŸ“Š **ç°æœ‰é‡å¤æ€§ä»»åŠ¡æ•°æ®ç»“æ„å›é¡¾**

### **å½“å‰tasksè¡¨çš„é‡å¤ä»»åŠ¡å­—æ®µ**
```sql
-- é‡å¤é…ç½®
repeat_type: 'once' | 'repeat'
repeat_frequency: 'daily' | 'weekly' | 'biweekly' | 'monthly' | 'yearly'
start_date: DATE                    -- é‡å¤å¼€å§‹æ—¥æœŸ
end_date: DATE                      -- é‡å¤ç»“æŸæ—¥æœŸ
repeat_weekdays: INTEGER[]          -- æ¯å‘¨é‡å¤çš„æ—¥å­
repeat_time: TIME                   -- æ¯æ—¥æ‰§è¡Œæ—¶é—´ç‚¹

-- ä¹ æƒ¯ä»»åŠ¡å­—æ®µï¼ˆå½“å‰ï¼‰
duration: '21days' | '1month' | '6months' | '1year'

-- æ—¶é—´çº¦æŸ
task_start_time: TIMESTAMPTZ        -- ä»»åŠ¡å¼€å§‹æ—¶é—´
task_end_time: TIMESTAMPTZ          -- ä»»åŠ¡ç»“æŸæ—¶é—´
deadline: TIMESTAMPTZ               -- æˆªæ­¢æ—¶é—´
```

### **ç°æœ‰ç»“æ„çš„ä¼˜åŠ¿**
1. âœ… **å·²ç»æ”¯æŒé‡å¤é…ç½®**: `repeat_frequency`, `start_date`, `end_date`
2. âœ… **å·²ç»æ”¯æŒæ—¶é—´çº¦æŸ**: `task_start_time`, `task_end_time`
3. âœ… **å·²ç»æ”¯æŒä¹ æƒ¯æ—¶é•¿**: `duration` å­—æ®µ
4. âœ… **æ•°æ®ç»“æ„å®Œæ•´**: åŸºæœ¬æ»¡è¶³é‡å¤ä»»åŠ¡éœ€æ±‚

---

## ğŸ—ï¸ **ç»Ÿä¸€ç³»ç»Ÿè®¾è®¡**

### **æ ¸å¿ƒæ€æƒ³ï¼šä¸€ä¸ªè¡¨ï¼Œä¸¤ç§æ¨¡å¼**

ä¸éœ€è¦åˆ›å»ºæ–°çš„è¡¨ç»“æ„ï¼Œåªéœ€è¦åœ¨ç°æœ‰`tasks`è¡¨åŸºç¡€ä¸Šå¢åŠ å‡ ä¸ªå…³é”®å­—æ®µï¼š

```sql
-- ğŸ¯ åªéœ€è¦æ·»åŠ è¿™äº›å­—æ®µåˆ°ç°æœ‰tasksè¡¨
ALTER TABLE tasks ADD COLUMN challenge_mode BOOLEAN DEFAULT FALSE;
ALTER TABLE tasks ADD COLUMN allow_flexible_start BOOLEAN DEFAULT FALSE;
ALTER TABLE tasks ADD COLUMN consecutive_required BOOLEAN DEFAULT FALSE;
ALTER TABLE tasks ADD COLUMN max_participants INTEGER;
```

### **ä¸¤ç§ä»»åŠ¡æ¨¡å¼**

#### **æ¨¡å¼1: ä¼ ç»Ÿé‡å¤ä»»åŠ¡ï¼ˆåˆ†é…æ¨¡å¼ï¼‰**
```typescript
{
  repeat_type: 'repeat',
  challenge_mode: false,           // ğŸ”‘ å…³é”®åŒºåˆ«
  repeat_frequency: 'daily',
  start_date: '2024-01-01',
  end_date: '2024-12-31',
  assignee_id: 'user123'           // ç›´æ¥åˆ†é…ç»™æ‰§è¡Œè€…
}
```

#### **æ¨¡å¼2: ä¹ æƒ¯æŒ‘æˆ˜ä»»åŠ¡ï¼ˆå‚ä¸æ¨¡å¼ï¼‰**
```typescript
{
  repeat_type: 'repeat',
  challenge_mode: true,            // ğŸ”‘ å…³é”®åŒºåˆ«
  repeat_frequency: 'daily',
  start_date: '2024-01-01',        // æŒ‘æˆ˜æ‹›å‹ŸæœŸé—´
  end_date: '2024-01-31',
  duration: '21days',              // ä¸ªäººæŒ‘æˆ˜æŒç»­æ—¶é—´
  allow_flexible_start: true,      // ç”¨æˆ·å¯ä»¥è‡ªé€‰å¼€å§‹æ—¶é—´
  consecutive_required: true,      // è¦æ±‚è¿ç»­å®Œæˆ
  assignee_id: null                // æ— ç›´æ¥åˆ†é…ï¼Œç”¨æˆ·ä¸»åŠ¨åŠ å…¥
}
```

---

## ğŸ“‹ **æ–°å¢çš„æ”¯æŒè¡¨**

### **ä»»åŠ¡å‚ä¸è®°å½•è¡¨ (task_participations)**
```sql
-- è®°å½•ç”¨æˆ·å‚ä¸ä»»åŠ¡çš„æƒ…å†µ
CREATE TABLE task_participations (
  id UUID PRIMARY KEY,
  task_id UUID REFERENCES tasks(id),
  user_id UUID REFERENCES auth.users(id),
  
  participation_type: 'assigned' | 'joined',
  personal_start_date: DATE,       -- ä¸ªäººå¼€å§‹æ—¥æœŸ
  personal_end_date: DATE,         -- ä¸ªäººç»“æŸæ—¥æœŸ
  
  completed_count: INTEGER,        -- å·²å®Œæˆæ¬¡æ•°
  current_streak: INTEGER,         -- å½“å‰è¿ç»­æ¬¡æ•°
  completion_rate: DECIMAL,        -- å®Œæˆç‡
  status: 'active' | 'completed' | 'abandoned'
);
```

### **ä»»åŠ¡å®Œæˆè®°å½•è¡¨ (task_completions)**
```sql
-- è®°å½•æ¯æ¬¡ä»»åŠ¡å®Œæˆçš„è¯¦ç»†ä¿¡æ¯
CREATE TABLE task_completions (
  id UUID PRIMARY KEY,
  participation_id UUID REFERENCES task_participations(id),
  completion_date: DATE,
  notes: TEXT,
  proof_url: TEXT,
  streak_day: INTEGER              -- è¿ç»­çš„ç¬¬å‡ å¤©
);
```

---

## ğŸ¯ **ç»Ÿä¸€ç³»ç»Ÿçš„ä¼˜åŠ¿**

### **1. æ¶æ„ç®€æ´**
- âœ… **å¤ç”¨ç°æœ‰ç»“æ„**: ä¸éœ€è¦é‡æ–°è®¾è®¡æ•°æ®åº“
- âœ… **æœ€å°åŒ–æ”¹åŠ¨**: åªæ·»åŠ å‡ ä¸ªå…³é”®å­—æ®µ
- âœ… **å‘åå…¼å®¹**: ç°æœ‰é‡å¤ä»»åŠ¡ç»§ç»­æ­£å¸¸å·¥ä½œ

### **2. åŠŸèƒ½å¼ºå¤§**
- âœ… **æ”¯æŒæ‰€æœ‰æ¨¡å¼**: ä¼ ç»Ÿåˆ†é…ã€æŒ‘æˆ˜å‚ä¸ã€æ··åˆæ¨¡å¼
- âœ… **çµæ´»é…ç½®**: å¯ä»¥ç»„åˆå„ç§å‚æ•°åˆ›å»ºä¸åŒç±»å‹çš„ä»»åŠ¡
- âœ… **è¿›åº¦è·Ÿè¸ª**: ç»Ÿä¸€çš„è¿›åº¦è·Ÿè¸ªå’Œç»Ÿè®¡ç³»ç»Ÿ

### **3. å¼€å‘æ•ˆç‡**
- âœ… **ä»£ç å¤ç”¨**: é‡å¤ä»»åŠ¡å’Œä¹ æƒ¯ä»»åŠ¡å…±äº«é€»è¾‘
- âœ… **ç»Ÿä¸€æ¥å£**: ä¸€å¥—APIå¤„ç†æ‰€æœ‰ä»»åŠ¡ç±»å‹
- âœ… **ç»´æŠ¤ç®€å•**: åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡ç³»ç»Ÿ

### **4. ç”¨æˆ·ä½“éªŒ**
- âœ… **ç•Œé¢ç»Ÿä¸€**: ç”¨æˆ·ä¸éœ€è¦åŒºåˆ†"é‡å¤ä»»åŠ¡"å’Œ"ä¹ æƒ¯ä»»åŠ¡"
- âœ… **åŠŸèƒ½ä¸°å¯Œ**: æ”¯æŒå„ç§ä»»åŠ¡æ¨¡å¼çš„ç»„åˆ
- âœ… **æ•°æ®å®Œæ•´**: å®Œæ•´çš„å‚ä¸å†å²å’Œè¿›åº¦ç»Ÿè®¡

---

## ğŸ”„ **å®é™…ä½¿ç”¨åœºæ™¯**

### **åœºæ™¯1: ä¼ ç»Ÿé‡å¤ä»»åŠ¡**
```typescript
// åˆ›å»ºä¸€ä¸ªæ¯æ—¥é‡å¤çš„å®¶åŠ¡ä»»åŠ¡
await unifiedTaskService.createTask({
  title: "æ¯æ—¥æ´—ç¢—",
  repeat_type: 'repeat',
  repeat_frequency: 'daily',
  challenge_mode: false,           // ä¼ ç»Ÿæ¨¡å¼
  start_date: '2024-01-01',
  end_date: '2024-12-31',
  assignee_id: 'partner_id'        // ç›´æ¥åˆ†é…ç»™ä¼´ä¾£
});
```

### **åœºæ™¯2: ä¹ æƒ¯æŒ‘æˆ˜ä»»åŠ¡**
```typescript
// åˆ›å»ºä¸€ä¸ª21å¤©æ—©èµ·æŒ‘æˆ˜
await unifiedTaskService.createTask({
  title: "21å¤©æ—©èµ·æŒ‘æˆ˜",
  repeat_type: 'repeat',
  repeat_frequency: 'daily',
  challenge_mode: true,            // æŒ‘æˆ˜æ¨¡å¼
  duration: '21days',
  start_date: '2024-01-01',        // æ‹›å‹ŸæœŸé—´
  end_date: '2024-01-31',
  allow_flexible_start: true,      // ç”¨æˆ·å¯ä»¥è‡ªé€‰å¼€å§‹æ—¶é—´
  consecutive_required: true,      // è¦æ±‚è¿ç»­å®Œæˆ
  max_participants: 10             // æœ€å¤š10äººå‚ä¸
});

// ç”¨æˆ·ä¸»åŠ¨åŠ å…¥æŒ‘æˆ˜
await unifiedTaskService.joinChallenge({
  task_id: 'challenge_id',
  user_id: 'user_id',
  start_date: '2024-01-15'         // ç”¨æˆ·é€‰æ‹©çš„å¼€å§‹æ—¶é—´
});
```

### **åœºæ™¯3: æ··åˆæ¨¡å¼ä»»åŠ¡**
```typescript
// åˆ›å»ºä¸€ä¸ªå¯ä»¥åˆ†é…ä¹Ÿå¯ä»¥ä¸»åŠ¨å‚ä¸çš„ä»»åŠ¡
await unifiedTaskService.createTask({
  title: "æ¯å‘¨å¥èº«æ‰“å¡",
  repeat_type: 'repeat',
  repeat_frequency: 'weekly',
  challenge_mode: true,            // æ”¯æŒä¸»åŠ¨å‚ä¸
  allow_flexible_start: false,     // å›ºå®šå¼€å§‹æ—¶é—´
  consecutive_required: false,     // ä¸è¦æ±‚è¿ç»­
  start_date: '2024-01-01',
  end_date: '2024-03-31'
});
```

---

## ğŸ“Š **æ•°æ®æµç¨‹å¯¹æ¯”**

### **ä¼ ç»Ÿé‡å¤ä»»åŠ¡æµç¨‹**
1. åˆ›å»ºè€…åˆ›å»ºä»»åŠ¡ â†’ ç›´æ¥åˆ†é…ç»™æ‰§è¡Œè€…
2. æ‰§è¡Œè€…çœ‹åˆ°åˆ†é…çš„ä»»åŠ¡ â†’ æŒ‰æ—¶å®Œæˆ
3. ç³»ç»Ÿè®°å½•å®Œæˆæƒ…å†µ â†’ æ›´æ–°ä»»åŠ¡çŠ¶æ€

### **ä¹ æƒ¯æŒ‘æˆ˜ä»»åŠ¡æµç¨‹**
1. åˆ›å»ºè€…åˆ›å»ºæŒ‘æˆ˜ â†’ å¼€æ”¾ç»™æ‰€æœ‰äººå‚ä¸
2. ç”¨æˆ·ä¸»åŠ¨åŠ å…¥æŒ‘æˆ˜ â†’ é€‰æ‹©ä¸ªäººå¼€å§‹æ—¶é—´
3. ç”¨æˆ·æ¯æ—¥æ‰“å¡å®Œæˆ â†’ ç³»ç»Ÿæ›´æ–°è¿›åº¦å’Œè¿ç»­è®°å½•
4. è¾¾åˆ°ç›®æ ‡æˆ–æ”¾å¼ƒ â†’ æŒ‘æˆ˜ç»“æŸ

### **ç»Ÿä¸€ç³»ç»Ÿæµç¨‹**
1. åˆ›å»ºä»»åŠ¡æ—¶é€‰æ‹©æ¨¡å¼ â†’ ç³»ç»Ÿæ ¹æ®æ¨¡å¼å¤„ç†
2. ç”¨æˆ·é€šè¿‡ç»Ÿä¸€æ¥å£å‚ä¸ â†’ åˆ†é…æˆ–åŠ å…¥
3. ç»Ÿä¸€çš„å®Œæˆæäº¤æ¥å£ â†’ ç³»ç»Ÿæ›´æ–°ç›¸åº”è®°å½•
4. ç»Ÿä¸€çš„è¿›åº¦æŸ¥çœ‹ç•Œé¢ â†’ æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡è¿›åº¦

---

## ğŸš€ **å®æ–½æ­¥éª¤**

### **é˜¶æ®µ1: æ•°æ®åº“æ‰©å±•ï¼ˆç«‹å³å¯è¡Œï¼‰**
```sql
-- è¿è¡Œæ‰©å±•è„šæœ¬
\i database/unified_task_system_extension.sql
```

### **é˜¶æ®µ2: æœåŠ¡å±‚æ›´æ–°**
```typescript
// ä½¿ç”¨æ–°çš„ç»Ÿä¸€æœåŠ¡
import { unifiedTaskService } from './services/unifiedTaskService';
```

### **é˜¶æ®µ3: å‰ç«¯é€‚é…**
- æ›´æ–°ä»»åŠ¡åˆ›å»ºUIï¼Œæ”¯æŒæŒ‘æˆ˜æ¨¡å¼é€‰é¡¹
- æ›´æ–°ä»»åŠ¡åˆ—è¡¨ï¼Œç»Ÿä¸€æ˜¾ç¤ºæ‰€æœ‰ç±»å‹ä»»åŠ¡
- å®ç°æŒ‘æˆ˜å‚ä¸å’Œæ‰“å¡ç•Œé¢

### **é˜¶æ®µ4: æ•°æ®è¿ç§»**
- ç°æœ‰é‡å¤ä»»åŠ¡ä¿æŒä¸å˜
- ç°æœ‰ä¹ æƒ¯ä»»åŠ¡æ ‡è®°ä¸ºæŒ‘æˆ˜æ¨¡å¼
- ä¸ºç°æœ‰åˆ†é…åˆ›å»ºå‚ä¸è®°å½•

---

## âœ… **æ€»ç»“**

è¿™ä¸ªç»Ÿä¸€ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

1. **æ¦‚å¿µç»Ÿä¸€**: ä¸å†åŒºåˆ†"é‡å¤ä»»åŠ¡"å’Œ"ä¹ æƒ¯ä»»åŠ¡"ï¼Œéƒ½æ˜¯"é‡å¤æ‰§è¡Œçš„ä»»åŠ¡"
2. **æ¶æ„ç®€æ´**: åŸºäºç°æœ‰ç»“æ„æ‰©å±•ï¼Œæœ€å°åŒ–æ”¹åŠ¨
3. **åŠŸèƒ½å¼ºå¤§**: æ”¯æŒå„ç§ä»»åŠ¡æ¨¡å¼çš„çµæ´»ç»„åˆ
4. **æ˜“äºç»´æŠ¤**: ä¸€å¥—ä»£ç å¤„ç†æ‰€æœ‰ä»»åŠ¡ç±»å‹
5. **ç”¨æˆ·å‹å¥½**: ç»Ÿä¸€çš„ç•Œé¢å’Œæ“ä½œæµç¨‹

è¿™æ ·çš„è®¾è®¡æ—¢ä¿æŒäº†ç°æœ‰ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œåˆä¸ºä¹ æƒ¯ä»»åŠ¡æä¾›äº†å®Œæ•´çš„æ”¯æŒï¼ŒåŒæ—¶ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•ç•™ä¸‹äº†å……è¶³çš„ç©ºé—´ã€‚

**å»ºè®®ç«‹å³åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿è¡Œæ‰©å±•è„šæœ¬ï¼ŒéªŒè¯è¿™ä¸ªç»Ÿä¸€ç³»ç»Ÿçš„å¯è¡Œæ€§ã€‚**
